<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Job Result</title>
	<script language="JavaScript">
	<!--

	var results_str = ""
		+ "T_ecv_ACCEPT_ORDER_DATA.csv置き換え,2019-04-10T04:15:31,2019-04-10T04:18:40,00:03:09\n"
		+ "T_ecv_ACCEPT_ORDER_DATA_union作成,2019-04-10T04:02:12,2019-04-10T04:15:30,00:13:18\n"
		+ "T_ecv_ACCEPT_ORDER_DETAIL_DATA.csv置き換え,2019-04-10T04:28:09,2019-04-10T04:30:50,00:02:41\n"
		+ "T_ecv_ACCEPT_ORDER_DETAIL_DATA_union作成,2019-04-10T04:17:50,2019-04-10T04:28:08,00:10:18\n"
		+ "T_ecv_ORDER_LOG.csv置き換え,2019-04-10T04:26:00,2019-04-10T04:28:26,00:02:26\n"
		+ "T_ecv_ORDER_LOG_union作成,2019-04-10T04:17:21,2019-04-10T04:25:59,00:08:38\n"
		+ "T_ecvg_ACCEPT_ORDER_DATA.csv置き換え,2019-04-10T04:01:48,2019-04-10T04:02:07,00:00:19\n"
		+ "T_ecvg_ACCEPT_ORDER_DATA_union作成,2019-04-10T04:00:53,2019-04-10T04:01:47,00:00:54\n"
		+ "T_ecvg_ACCEPT_ORDER_DETAIL_DATA.csv作成,2019-04-10T04:16:40,2019-04-10T04:16:56,00:00:16\n"
		+ "T_ecvg_ACCEPT_ORDER_DETAIL_DATA_union作成,2019-04-10T04:16:09,2019-04-10T04:16:39,00:00:30\n"
		+ "T_ecvg_ORDER_LOG.csv置き換え,2019-04-09T05:55:18,2019-04-09T05:55:36,00:00:18\n"
		+ "T_ecvg_ORDER_LOG_union作成,2019-04-09T05:54:42,2019-04-09T05:55:17,00:00:35\n"
		+ "T_gecs_ACCEPT_ORDER_DATA.csv置き換え,2019-04-10T04:01:22,2019-04-10T04:01:37,00:00:15\n"
		+ "T_gecs_ACCEPT_ORDER_DATA_union作成,2019-04-10T04:00:56,2019-04-10T04:01:21,00:00:25\n"
		+ "T_gecs_ACCEPT_ORDER_DETAIL_DATA.csv置き換え,2019-04-10T04:16:39,2019-04-10T04:16:51,00:00:12\n"
		+ "T_gecs_ACCEPT_ORDER_DETAIL_DATA_union作成,2019-04-10T04:16:21,2019-04-10T04:16:39,00:00:18\n"
		+ "T_gecs_ORDER_LOG.csv置き換え,2019-04-10T04:16:47,2019-04-10T04:17:01,00:00:14\n"
		+ "T_gecs_ORDER_LOG_union作成,2019-04-10T04:16:26,2019-04-10T04:16:46,00:00:20\n"
		+ "T_man_目標マスタ作成,2019-04-05T19:50:44,2019-04-05T19:50:57,00:00:13\n"
		+ "M_ec_会員マスタ作成,2019-04-10T06:00:03,2019-04-10T06:31:13,00:31:10\n"
		+ "C_ecv_受注明細作成,2019-04-10T06:31:16,2019-04-10T07:30:44,00:59:28\n"
		+ "C_gec_受注明細作成,2019-04-10T06:31:19,2019-04-10T06:36:44,00:05:25\n"
		+ "C_tml_受注明細作成,2019-04-01T18:56:17,2019-04-01T18:57:16,00:00:59\n"
		+ "C_ec_受注明細作成,2019-04-10T07:30:46,2019-04-10T07:59:41,00:28:55\n"
		+ "C_ec_受注作成,2019-04-10T07:59:42,2019-04-10T08:19:00,00:19:18\n"
		+ "C_ec_アクティブ作成,2019-04-10T08:19:01,2019-04-10T10:20:35,02:01:34\n"
		+ "C_ec_商品作成,2019-04-10T07:59:44,2019-04-10T08:48:05,00:48:21\n"
		+ "C_ec_期間別受注作成,2019-04-10T10:20:57,2019-04-10T11:01:54,00:40:57\n";

	var results_str = ""
+ "job1,2019-04-10T04:15:31,2019-04-10T04:18:40,0:03:09\n"
+ "job2,2019-04-10T04:02:12,2019-04-10T04:15:30,0:13:18\n"
+ "job3,2019-04-10T04:28:09,2019-04-10T04:30:50,0:02:41\n"
+ "job4,2019-04-10T04:17:50,2019-04-10T04:28:08,0:10:18\n"
+ "job5,2019-04-10T04:26:00,2019-04-10T04:28:26,0:02:26\n"
+ "job6,2019-04-10T04:17:21,2019-04-10T04:25:59,0:08:38\n"
+ "job7,2019-04-10T04:01:48,2019-04-10T04:02:07,0:00:19\n"
+ "job8,2019-04-10T04:00:53,2019-04-10T04:01:47,0:00:54\n"
+ "job9,2019-04-10T04:16:40,2019-04-10T04:16:56,0:00:16\n"
+ "job10,2019-04-10T04:16:09,2019-04-10T04:16:39,0:00:30\n"
+ "job11,2019-04-09T05:55:18,2019-04-09T05:55:36,0:00:18\n"
+ "job12,2019-04-09T05:54:42,2019-04-09T05:55:17,0:00:35\n"
+ "job13,2019-04-10T04:01:22,2019-04-10T04:01:37,0:00:15\n"
+ "job14,2019-04-10T04:00:56,2019-04-10T04:01:21,0:00:25\n"
+ "job15,2019-04-10T04:16:39,2019-04-10T04:16:51,0:00:12\n"
+ "job16,2019-04-10T04:16:21,2019-04-10T04:16:39,0:00:18\n"
+ "job17,2019-04-10T04:16:47,2019-04-10T04:17:01,0:00:14\n"
+ "job18,2019-04-10T04:16:26,2019-04-10T04:16:46,0:00:20\n"
+ "job19,2019-04-05T19:50:44,2019-04-05T19:50:57,0:00:13\n"
+ "job20,2019-04-10T06:00:03,2019-04-10T06:31:13,0:31:10\n"
+ "job21,2019-04-10T06:31:16,2019-04-10T07:30:44,0:59:28\n"
+ "job22,2019-04-10T06:31:19,2019-04-10T06:36:44,0:05:25\n"
+ "job23,2019-04-01T18:56:17,2019-04-01T18:57:16,0:00:59\n"
+ "job24,2019-04-10T07:30:46,2019-04-10T07:59:41,0:28:55\n"
+ "job25,2019-04-10T07:59:42,2019-04-10T08:19:00,0:19:18\n"
+ "job26,2019-04-10T08:19:01,2019-04-10T10:20:35,2:01:34\n"
+ "job27,2019-04-10T07:59:44,2019-04-10T08:48:05,0:48:21\n"
+ "job28,2019-04-10T10:20:57,2019-04-10T11:01:54,0:40:57"


	function onload()
	{
		// 処理日
		var disp_dt = new Date();
		
		// ログを配列にする
		var log_infos = [];
		var log_ary = results_str.split(/\r\n|\n/);
		for( var i=0; i<log_ary.length; i++){
			var log = log_ary[i];
			if( log.length==0 ){continue;}
			var one_log = log.split(/,/);
			
			var start_dt = new Date(Date.parse(one_log[1]));
			var end_dt = new Date(Date.parse(one_log[2]));
			var spent_dt = new Date(Date.parse(one_log[3]));
			
			// disp_dtだけを追加する
			if(
				(start_dt.getFullYear()!=disp_dt.getFullYear()) ||
				(start_dt.getMonth()!=disp_dt.getMonth()) ||
				(start_dt.getDate()!=disp_dt.getDate())
			){
				continue
			}

			log_infos.push({
				'name' : one_log[0],
				'start': start_dt,
				'end'  : end_dt,
				'spent': spent_dt
			});
		}
		console.log(log_infos);

		// 一番小さい時刻と一番大きな時刻を取得
		var min_tm = log_infos[0]['start'];
		var max_tm = log_infos[0]['end'];
		for( var i=0; i<log_infos.length; i++){
			if(log_infos[i]['start']<min_tm){ min_tm = log_infos[i]['start']}
			if(log_infos[i]['end']<min_tm){ min_tm = log_infos[i]['end']}
			if(log_infos[i]['start']>max_tm){ max_tm = log_infos[i]['start']}
			if(log_infos[i]['end']>max_tm){ max_tm = log_infos[i]['end']}
		}
		console.log('min'+min_tm);
		console.log('max'+max_tm);

		// 絵の幅を決定
		var NAME_WIDTH = 300;	// 名前の幅
		var HOUR_WIDTH = 100;	// １時間の幅
		var ONE_LINE_HEIGHT = 30;	// １行の高さ
		var LINE_PADDING = 8;	// padding
		var width = NAME_WIDTH
			+ (max_tm.getHours() - min_tm.getHours() + 1) * HOUR_WIDTH;
		var height = ONE_LINE_HEIGHT * (1+log_infos.length);
		console.log('width:'+ width);
		console.log('height:'+ height);
		// キャンバスのサイズを変更する
		document.getElementById("can1").setAttribute('width', width);
		document.getElementById("can1").setAttribute('height', height);

		// 描画
		var can1 = document.getElementById("can1");
		var ctx1 = can1.getContext("2d");
		
		// ヘッダ
		ctx1.fillStyle = "rgb(150,200,100)";
		ctx1.fillRect(0,0,width,ONE_LINE_HEIGHT);
		ctx1.fillStyle = "rgb(200,230,180)";
		ctx1.fillRect(0,ONE_LINE_HEIGHT+1, NAME_WIDTH,height);
		// 行
		ctx1.fillStyle = "rgba(200,200,200,0.15)";
		for( var i=2; i<(log_infos.length+1); i+=2){
			ctx1.fillRect(0,i*ONE_LINE_HEIGHT, width, ONE_LINE_HEIGHT);
		}

		// 時刻ごとの罫線（縦線）
		ctx1.strokeStyle = "#eed";
		ctx1.lineWidth = 1;
		for( var i=0; i<(max_tm.getHours() - min_tm.getHours() + 1); i++){
			ctx1.beginPath();
			ctx1.moveTo(
				NAME_WIDTH + HOUR_WIDTH*i, 
				0
			)
			ctx1.lineTo(
				NAME_WIDTH + HOUR_WIDTH*i, 
				height
			)
			ctx1.closePath();
			ctx1.stroke();
		}
		ctx1.strokeStyle = "#ddd";
		ctx1.lineWidth = 1;
		ctx1.setLineDash([5,10]);
		for( var i=0; i<(max_tm.getHours() - min_tm.getHours() + 1); i++){
			ctx1.beginPath();
			ctx1.moveTo(
				NAME_WIDTH + HOUR_WIDTH*i + HOUR_WIDTH/2, 
				ONE_LINE_HEIGHT
			)
			ctx1.lineTo(
				NAME_WIDTH + HOUR_WIDTH*i + HOUR_WIDTH/2, 
				height
			)
			ctx1.closePath();
			ctx1.stroke();
		}
		ctx1.setLineDash([]);	// 破線を戻す
		// ジョブごとの罫線（横線）
		ctx1.strokeStyle = "#bba";
		for( var i=0; i<(log_infos.length+1); i++){
			ctx1.beginPath();
			ctx1.moveTo(
				0, 
				ONE_LINE_HEIGHT*i
			)
			ctx1.lineTo(
				width,
				ONE_LINE_HEIGHT*i
			)
			ctx1.closePath();
			ctx1.stroke();
		}
		// 時刻
		ctx1.fillStyle = "rgb(0,0,0)";
		ctx1.font = "10px メイリオ";
		var min_hour = min_tm.getHours();
		for( var i=0; i<(max_tm.getHours() - min_tm.getHours() + 1); i++){
			ctx1.fillText(
				(min_hour + i) + ':00',
				NAME_WIDTH + HOUR_WIDTH * i,
				ONE_LINE_HEIGHT
			)
		}

		// ジョブごとの時刻を描画する
		// 実行時刻
		ctx1.font = (ONE_LINE_HEIGHT-LINE_PADDING*2) + "px メイリオ";
		for( var i=0; i<log_infos.length; i++){
			var startPos = NAME_WIDTH
				+ (
					roundHour(log_infos[i]['start'])
					- min_tm.getHours()
				) * HOUR_WIDTH;
			var endPos = NAME_WIDTH
				+ (
					roundHour(log_infos[i]['end'])
					- min_tm.getHours()
				) * HOUR_WIDTH;
			
			// 実行時刻
			var str_spent = ''
				+ log_infos[i]['spent'].getHours()
				+ ('0' + log_infos[i]['spent'].getMinutes()).slice(-2)
				+ ('0' + log_infos[i]['spent'].getSeconds()).slice(-2);
			
			ctx1.fillStyle = "#c66";
			ctx1.fillRect(
				startPos,
				ONE_LINE_HEIGHT * (i+1) + LINE_PADDING,
				endPos - startPos,
				ONE_LINE_HEIGHT - LINE_PADDING*2
			);
			
			/*
			ctx1.fillStyle = "rgb(10,10,10)";
			ctx1.fillText(
				str_spent,
				endPos,
				ONE_LINE_HEIGHT * (i+2) - LINE_PADDING,
			)
			*/
		}
		// ジョブ名
		ctx1.fillStyle = "rgb(10,10,10)";
		ctx1.font = (ONE_LINE_HEIGHT-LINE_PADDING*2) + "px メイリオ";
		for( var i=0; i<log_infos.length; i++){
			ctx1.fillText(
				log_infos[i]['name'],
				LINE_PADDING,
				ONE_LINE_HEIGHT * (i+2) - LINE_PADDING
			)
		}

	}

	// 日時の時・分・秒から、時の小数点にする
	function roundHour(dt){
		return dt.getHours() + dt.getMinutes()/60 + dt.getSeconds()/(60*60);
	}
	
	// -->
	</script>
</head>

<body onload="onload()">
    <canvas
        id="can1"
        width="50" height="50"
        style="border:1px solid #393"
    ></canvas>
</body>

</html>